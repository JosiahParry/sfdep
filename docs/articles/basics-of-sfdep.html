<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="sfdep">
<title>The Basics of sfdep • sfdep</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Noto_Sans_Display-0.4.8/font.css" rel="stylesheet">
<link href="../deps/Noto_Sans_Mono-0.4.8/font.css" rel="stylesheet">
<link href="../deps/Merriweather-0.4.8/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="The Basics of sfdep">
<meta property="og:description" content="sfdep">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">sfdep</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vignettes">Vignettes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-vignettes">
    <a class="dropdown-item" href="../articles/basics-of-sfdep.html">Basics of sfdep</a>
    <a class="dropdown-item" href="../articles/spacetime-s3.html">spacetime and spacetime cubes</a>
    <a class="dropdown-item" href="../articles/colocation-analysis.html">Colocation Quotients</a>
    <a class="dropdown-item" href="../articles/conditional-permutation.html">Conditional permutation</a>
    <a class="dropdown-item" href="../articles/understanding-emerging-hotspots.html">Emerging Hot Spot Analysis</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-releases">Releases</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-releases">
    <a class="dropdown-item" href="../articles/Version-0-2-0.html">Version 0.2.0</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/josiahparry/sfdep/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>The Basics of sfdep</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/josiahparry/sfdep/blob/HEAD/vignettes/articles/basics-of-sfdep.Rmd" class="external-link"><code>vignettes/articles/basics-of-sfdep.Rmd</code></a></small>
      <div class="d-none name"><code>basics-of-sfdep.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sfdep.josiahparry.com" class="external-link">sfdep</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>The goal of this vignette is to familiarize you with the basics of
sfdep:</p>
<ul>
<li>creating neighbors</li>
<li>creating weights</li>
<li>calculating a LISA</li>
<li>
</ul>
<div class="section level2">
<h2 id="intro-what-is-spatial-relationship">Intro / what is spatial relationship<a class="anchor" aria-label="anchor" href="#intro-what-is-spatial-relationship"></a>
</h2>
<p>sfdep provides users with a way to conduct “Exploratory Spatial Data
Analysis”, or ESDA for short. ESDA differs from typical exploratory data
analysis in that we are strictly exploring spatial relationships. As you
might have guessed, ESDA evaluates whether the phenomena captured in
your data are dependent upon space–or are spatially auto-correlated.
Much of ESDA is focused on “Local Indicators of Spatial Association”,
LISAs for short. LISAs are measures that are developed to identify
whether some observed pattern is truly random or impacted by its
relationship in space.</p>
<p>Much of the philosophy of LISAs and ESDA are captured in Tobler’s
First Law of Geography</p>
<blockquote>
<p>“Everything is related to everything else. But near things are more
related than distant things.” - Waldo R. Tobler, 1969</p>
</blockquote>
<p>It’s tough to state this any more simply. Things that are next to
each other tend to be more similar than things that are further
away.</p>
<p>To assess whether near things are related and further things less so,
we typically <strong>lattice data</strong>. A lattice is created when a
landscape or region is divided into sub-areas. Most naturally, these
types of data are represented as vector polygons.</p>
</div>
<div class="section level2">
<h2 id="neighbors">Neighbors<a class="anchor" aria-label="anchor" href="#neighbors"></a>
</h2>
<p>To describe neighbors I’m going to steal extensively from my own post
<a href="https://www.urban-informatics.org/tutorials/2021-05-07-spatial-autocorrelation-in-r/" class="external-link">“Understanding
Spatial Autocorrelation”</a>.</p>
<p>If we assume that there is a spatial relationship in our data, we are
taking on the belief that our data are not completely independent of
each other. If nearer things are more related, then census tracts that
are close to each other will have similar values.</p>
<p>In order to evaluate whether nearer things are related, we must know
what observations are nearby. With polygon data we identify neighbors
based on their contiguity. To be contiguous means to be connected or
touching—think of the <em>contiguous</em> lower 48 states.</p>
<div class="section level3">
<h3 id="contiguities">Contiguities<a class="anchor" aria-label="anchor" href="#contiguities"></a>
</h3>
<p>The two most common contiguities are based on the game of chess.
Let’s take a simple chess board.</p>
<p><img src="basics-of-sfdep_files/figure-html/unnamed-chunk-2-1.png" width="600px"></p>
<p>In chess each piece can move in a different way. All pieces, with the
exception of the knight, move either diagonally or horizontally and
vertically. The most common contiguities are queen and rook
contiguities. In chess, a queen can move diagonally and horizontal and
vertically whereas a rook can only move horizontal and vertically.</p>
<p><img src="basics-of-sfdep_files/figure-html/unnamed-chunk-3-1.png" width="600px"></p>
<p>We extend this idea to polygons. Queen contiguities identify
neighbors based on any polygon that is touching. With rook contiguities,
we identify neighbors based on polygons that touch on the side. For most
social science research, we only need to be concerned with queen
contiguities.</p>
<p>While a chess board might make intuitive sense, geographies are
really wonky in real life. Below is map of the 47th observation in the
<code>guerry</code> object and it’s queen contiguity neighbors.</p>
<p><img src="basics-of-sfdep_files/figure-html/unnamed-chunk-4-1.png" width="600px"></p>
<p>You can see that any polygon that is touching, even at a corner, will
be considered a neighbor to the point in question. This will be done for
<em>every</em> polygon in our data set.</p>
</div>
</div>
<div class="section level2">
<h2 id="understanding-the-spatial-weights">Understanding the spatial weights<a class="anchor" aria-label="anchor" href="#understanding-the-spatial-weights"></a>
</h2>
<p>Once neighbors are identified, they can then be used to calculate
<strong>spatial weights</strong>. The typical method of calculating the
spatial weights is through row standardization
(<code>st_weights(nb, style = "W")</code>). Each neighbor that touches
our census tract will be assigned an equal weight. We do this by
assigning each neighbor a value of 1 then dividing by the number of
neighbors. If we have 5 neighboring census tracts, each of them will
have a spatial weight of 0.2 (1 / 5 = 0.2).</p>
<p>Going back to the chess board example, we can take the position d4
and look at the queen contiguities. There are 8 squares that immediately
touch the square. Each one of these squares is considered a neighbor and
given a value of 1. Then each square is divided by the total number or
neighbors, 8.</p>
<p><img src="basics-of-sfdep_files/figure-html/unnamed-chunk-5-1.png" width="600px">
Very simply it looks like the following</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">d4_nbs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1 1 1 1 1 1 1 1</span></span>
<span></span>
<span><span class="va">d4_nbs</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">d4_nbs</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creating-neighbors-and-weights">Creating Neighbors and Weights<a class="anchor" aria-label="anchor" href="#creating-neighbors-and-weights"></a>
</h2>
<p>sfdep utilizes list objects for both neighbors and weights. The
neighbors and weights lists.</p>
<p>To identify contiguity-based neighbors, we use
<code><a href="../reference/st_contiguity.html">st_contiguity()</a></code> on the sf geometry column. And to calculate
the weights from the neighbors list, we use <code><a href="../reference/st_weights.html">st_weights()</a></code> on
the resultant neighbors list. By convention these are typically called
<code>nb</code> and <code>wt</code>.</p>
<p>These lists can be created line by line or within a pipe. The most
common usecase is likely via a dplyr pipeline.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">guerry_nb</span> <span class="op">&lt;-</span> <span class="va">guerry</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>nb <span class="op">=</span> <span class="fu"><a href="../reference/st_contiguity.html">st_contiguity</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span>,</span>
<span>         wt <span class="op">=</span> <span class="fu"><a href="../reference/st_weights.html">st_weights</a></span><span class="op">(</span><span class="va">nb</span><span class="op">)</span>,</span>
<span>         .before <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># to put them in the front</span></span>
<span></span>
<span><span class="va">guerry_nb</span></span>
<span><span class="co">#&gt; Simple feature collection with 85 features and 28 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 47680 ymin: 1703258 xmax: 1031401 ymax: 2677441</span></span>
<span><span class="co">#&gt; CRS:           NA</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 85 × 29</span></span></span>
<span><span class="co">#&gt;    nb        wt    code_dept count ave_id_geo  dept region department crime_pers</span></span>
<span><span class="co">#&gt;  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;nb&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;lis&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> <span style="color: #949494;">&lt;int [4]&gt;</span> <span style="color: #949494;">&lt;dbl&gt;</span> 01            1         49     1 E      Ain             <span style="text-decoration: underline;">28</span>870</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> <span style="color: #949494;">&lt;int [6]&gt;</span> <span style="color: #949494;">&lt;dbl&gt;</span> 02            1        812     2 N      Aisne           <span style="text-decoration: underline;">26</span>226</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> <span style="color: #949494;">&lt;int [6]&gt;</span> <span style="color: #949494;">&lt;dbl&gt;</span> 03            1       <span style="text-decoration: underline;">1</span>418     3 C      Allier          <span style="text-decoration: underline;">26</span>747</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> <span style="color: #949494;">&lt;int [4]&gt;</span> <span style="color: #949494;">&lt;dbl&gt;</span> 04            1       <span style="text-decoration: underline;">1</span>603     4 E      Basses-Al…      <span style="text-decoration: underline;">12</span>935</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> <span style="color: #949494;">&lt;int [3]&gt;</span> <span style="color: #949494;">&lt;dbl&gt;</span> 05            1       <span style="text-decoration: underline;">1</span>802     5 E      Hautes-Al…      <span style="text-decoration: underline;">17</span>488</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> <span style="color: #949494;">&lt;int [7]&gt;</span> <span style="color: #949494;">&lt;dbl&gt;</span> 07            1       <span style="text-decoration: underline;">2</span>249     7 S      Ardeche          <span style="text-decoration: underline;">9</span>474</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> <span style="color: #949494;">&lt;int [3]&gt;</span> <span style="color: #949494;">&lt;dbl&gt;</span> 08            1      <span style="text-decoration: underline;">35</span>395     8 N      Ardennes        <span style="text-decoration: underline;">35</span>203</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> <span style="color: #949494;">&lt;int [3]&gt;</span> <span style="color: #949494;">&lt;dbl&gt;</span> 09            1       <span style="text-decoration: underline;">2</span>526     9 S      Ariege           <span style="text-decoration: underline;">6</span>173</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> <span style="color: #949494;">&lt;int [5]&gt;</span> <span style="color: #949494;">&lt;dbl&gt;</span> 10            1      <span style="text-decoration: underline;">34</span>410    10 E      Aube            <span style="text-decoration: underline;">19</span>602</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> <span style="color: #949494;">&lt;int [5]&gt;</span> <span style="color: #949494;">&lt;dbl&gt;</span> 11            1       <span style="text-decoration: underline;">2</span>807    11 S      Aude            <span style="text-decoration: underline;">15</span>647</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 75 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 20 more variables: crime_prop &lt;int&gt;, literacy &lt;int&gt;, donations &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   infants &lt;int&gt;, suicides &lt;int&gt;, main_city &lt;ord&gt;, wealth &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   commerce &lt;int&gt;, clergy &lt;int&gt;, crime_parents &lt;int&gt;, infanticide &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   donation_clergy &lt;int&gt;, lottery &lt;int&gt;, desertion &lt;int&gt;, instruction &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   prostitutes &lt;int&gt;, distance &lt;dbl&gt;, area &lt;int&gt;, pop1831 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   geometry &lt;MULTIPOLYGON&gt;</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="calculating-lisas">Calculating LISAs<a class="anchor" aria-label="anchor" href="#calculating-lisas"></a>
</h2>
<p>To calculate LISAs we typically will provide a numeric object(s), a
neighbor list, and a weights list–and often the argument
<code>nsim</code> to determine the number of simulations to run. Most
LISAs return a data frame of the same number of rows as the input
dataframe. The resultant data frame can be unnested, or columns hoisted
for ease of analysis.</p>
<p>For example to calculate the Local Moran we use the function
<code><a href="../reference/local_moran.html">local_moran()</a></code></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lisa</span> <span class="op">&lt;-</span> <span class="va">guerry_nb</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>local_moran <span class="op">=</span> <span class="fu"><a href="../reference/local_moran.html">local_moran</a></span><span class="op">(</span><span class="va">crime_pers</span>, <span class="va">nb</span>, <span class="va">wt</span>, nsim <span class="op">=</span> <span class="fl">199</span><span class="op">)</span>,</span>
<span>         .before <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lisa</span></span>
<span><span class="co">#&gt; Simple feature collection with 85 features and 29 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 47680 ymin: 1703258 xmax: 1031401 ymax: 2677441</span></span>
<span><span class="co">#&gt; CRS:           NA</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 85 × 30</span></span></span>
<span><span class="co">#&gt;    local_moran$ii nb    wt    code_dept count ave_id_geo  dept region department</span></span>
<span><span class="co">#&gt;  <span style="color: #BCBCBC;">*</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;nb&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;lis&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>         0.522  <span style="color: #949494;">&lt;int&gt;</span> <span style="color: #949494;">&lt;dbl&gt;</span> 01            1         49     1 E      Ain       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>         0.828  <span style="color: #949494;">&lt;int&gt;</span> <span style="color: #949494;">&lt;dbl&gt;</span> 02            1        812     2 N      Aisne     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>         0.804  <span style="color: #949494;">&lt;int&gt;</span> <span style="color: #949494;">&lt;dbl&gt;</span> 03            1       <span style="text-decoration: underline;">1</span>418     3 C      Allier    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>         0.742  <span style="color: #949494;">&lt;int&gt;</span> <span style="color: #949494;">&lt;dbl&gt;</span> 04            1       <span style="text-decoration: underline;">1</span>603     4 E      Basses-Al…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>         0.231  <span style="color: #949494;">&lt;int&gt;</span> <span style="color: #949494;">&lt;dbl&gt;</span> 05            1       <span style="text-decoration: underline;">1</span>802     5 E      Hautes-Al…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>         0.839  <span style="color: #949494;">&lt;int&gt;</span> <span style="color: #949494;">&lt;dbl&gt;</span> 07            1       <span style="text-decoration: underline;">2</span>249     7 S      Ardeche   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>         0.623  <span style="color: #949494;">&lt;int&gt;</span> <span style="color: #949494;">&lt;dbl&gt;</span> 08            1      <span style="text-decoration: underline;">35</span>395     8 N      Ardennes  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>         1.65   <span style="color: #949494;">&lt;int&gt;</span> <span style="color: #949494;">&lt;dbl&gt;</span> 09            1       <span style="text-decoration: underline;">2</span>526     9 S      Ariege    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>        -<span style="color: #BB0000;">0.019</span><span style="color: #BB0000; text-decoration: underline;">8</span> <span style="color: #949494;">&lt;int&gt;</span> <span style="color: #949494;">&lt;dbl&gt;</span> 10            1      <span style="text-decoration: underline;">34</span>410    10 E      Aube      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>         0.695  <span style="color: #949494;">&lt;int&gt;</span> <span style="color: #949494;">&lt;dbl&gt;</span> 11            1       <span style="text-decoration: underline;">2</span>807    11 S      Aude      </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 75 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 32 more variables: local_moran$eii &lt;dbl&gt;, $var_ii &lt;dbl&gt;, $z_ii &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   $p_ii &lt;dbl&gt;, $p_ii_sim &lt;dbl&gt;, $p_folded_sim &lt;dbl&gt;, $skewness &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   $kurtosis &lt;dbl&gt;, $mean &lt;fct&gt;, $median &lt;fct&gt;, $pysal &lt;fct&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   crime_pers &lt;int&gt;, crime_prop &lt;int&gt;, literacy &lt;int&gt;, donations &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   infants &lt;int&gt;, suicides &lt;int&gt;, main_city &lt;ord&gt;, wealth &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   commerce &lt;int&gt;, clergy &lt;int&gt;, crime_parents &lt;int&gt;, infanticide &lt;int&gt;, …</span></span></span></code></pre></div>
<p>Now that we have a data frame, we need to unnest it.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lisa</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">local_moran</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 85 features and 40 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 47680 ymin: 1703258 xmax: 1031401 ymax: 2677441</span></span>
<span><span class="co">#&gt; CRS:           NA</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 85 × 41</span></span></span>
<span><span class="co">#&gt;         ii       eii   var_ii   z_ii    p_ii p_ii_sim p_folded_sim skewness</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  0.522  -<span style="color: #BB0000;">0.046</span><span style="color: #BB0000; text-decoration: underline;">3</span>   0.364     0.943 0.346       0.36        0.18   0.048<span style="text-decoration: underline;">8</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  0.828  -<span style="color: #BB0000;">0.038</span><span style="color: #BB0000; text-decoration: underline;">2</span>   0.112     2.59  0.009<span style="text-decoration: underline;">67</span>     0.03        0.015  0.393  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  0.804  -<span style="color: #BB0000;">0.024</span><span style="color: #BB0000; text-decoration: underline;">2</span>   0.165     2.04  0.041<span style="text-decoration: underline;">6</span>      0.1         0.05   0.292  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  0.742   0.038<span style="text-decoration: underline;">2</span>   0.263     1.37  0.170       0.14        0.07   0.023<span style="text-decoration: underline;">9</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  0.231  -<span style="color: #BB0000;">0.003</span><span style="color: #BB0000; text-decoration: underline;">16</span>  0.030<span style="text-decoration: underline;">7</span>    1.34  0.181       0.14        0.07  -<span style="color: #BB0000;">0.115</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  0.839  -<span style="color: #BB0000;">0.023</span><span style="color: #BB0000; text-decoration: underline;">4</span>   0.336     1.49  0.137       0.16        0.08  -<span style="color: #BB0000;">0.034</span><span style="color: #BB0000; text-decoration: underline;">8</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  0.623   0.068<span style="text-decoration: underline;">0</span>   1.53      0.449 0.653       0.66        0.33  -<span style="color: #BB0000;">0.001</span><span style="color: #BB0000; text-decoration: underline;">21</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  1.65   -<span style="color: #BB0000;">0.078</span><span style="color: #BB0000; text-decoration: underline;">3</span>   0.892     1.83  0.067<span style="text-decoration: underline;">8</span>      0.07        0.035 -<span style="color: #BB0000;">0.065</span><span style="color: #BB0000; text-decoration: underline;">6</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> -<span style="color: #BB0000;">0.019</span><span style="color: #BB0000; text-decoration: underline;">8</span>  0.000<span style="text-decoration: underline;">993</span> 0.000<span style="text-decoration: underline;">436</span> -<span style="color: #BB0000;">0.993</span> 0.321       0.32        0.16  -<span style="color: #BB0000;">0.197</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  0.695   0.023<span style="text-decoration: underline;">8</span>   0.085<span style="text-decoration: underline;">9</span>    2.29  0.021<span style="text-decoration: underline;">9</span>      0.02        0.01   0.114  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 75 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 33 more variables: kurtosis &lt;dbl&gt;, mean &lt;fct&gt;, median &lt;fct&gt;, pysal &lt;fct&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   nb &lt;nb&gt;, wt &lt;list&gt;, code_dept &lt;fct&gt;, count &lt;dbl&gt;, ave_id_geo &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   dept &lt;int&gt;, region &lt;fct&gt;, department &lt;fct&gt;, crime_pers &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   crime_prop &lt;int&gt;, literacy &lt;int&gt;, donations &lt;int&gt;, infants &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   suicides &lt;int&gt;, main_city &lt;ord&gt;, wealth &lt;int&gt;, commerce &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   clergy &lt;int&gt;, crime_parents &lt;int&gt;, infanticide &lt;int&gt;, …</span></span></span></code></pre></div>
<p>This can then be used for visualization or further analysis.</p>
<p>Additionally, for other LISAs that can take any number of inputs,
e.g. 3 or more numeric variables, we provide this as a list. Take for
example the Local C statistic.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">guerry_nb</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>local_c <span class="op">=</span> <span class="fu"><a href="../reference/local_c.html">local_c_perm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">crime_pers</span>, <span class="va">wealth</span><span class="op">)</span>, <span class="va">nb</span>, <span class="va">wt</span><span class="op">)</span>, </span>
<span>         .before <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">local_c</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 85 features and 38 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 47680 ymin: 1703258 xmax: 1031401 ymax: 2677441</span></span>
<span><span class="co">#&gt; CRS:           NA</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 85 × 39</span></span></span>
<span><span class="co">#&gt;       ci cluster   e_ci var_ci   z_ci   p_ci p_ci_sim p_folded_sim skewness</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1.53  Positive  2.44  0.665 -<span style="color: #BB0000;">1.11</span>  0.266     0.284        0.142    0.176</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 0.500 Positive  1.74  0.387 -<span style="color: #BB0000;">1.99</span>  0.046<span style="text-decoration: underline;">5</span>    0.02         0.01     0.511</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 0.642 Positive  1.70  0.251 -<span style="color: #BB0000;">2.12</span>  0.034<span style="text-decoration: underline;">1</span>    0.024        0.012    0.105</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 0.324 Positive  2.27  0.834 -<span style="color: #BB0000;">2.13</span>  0.032<span style="text-decoration: underline;">8</span>    0.02         0.01     0.129</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 0.298 Positive  2.33  0.971 -<span style="color: #BB0000;">2.06</span>  0.039<span style="text-decoration: underline;">6</span>    0.008        0.004    0.264</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1.60  Positive  3.38  0.708 -<span style="color: #BB0000;">2.11</span>  0.035<span style="text-decoration: underline;">3</span>    0.036        0.018    0.193</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2.04  Positive  3.22  1.60  -<span style="color: #BB0000;">0.931</span> 0.352     0.372        0.186    0.272</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2.20  Positive  3.40  1.74  -<span style="color: #BB0000;">0.905</span> 0.366     0.392        0.196    0.207</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 0.507 Positive  1.68  0.367 -<span style="color: #BB0000;">1.95</span>  0.051<span style="text-decoration: underline;">8</span>    0.04         0.02     0.196</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 1.46  Positive  1.72  0.371 -<span style="color: #BB0000;">0.424</span> 0.671     0.684        0.342    0.263</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 75 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 30 more variables: kurtosis &lt;dbl&gt;, nb &lt;nb&gt;, wt &lt;list&gt;, code_dept &lt;fct&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   count &lt;dbl&gt;, ave_id_geo &lt;dbl&gt;, dept &lt;int&gt;, region &lt;fct&gt;, department &lt;fct&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   crime_pers &lt;int&gt;, crime_prop &lt;int&gt;, literacy &lt;int&gt;, donations &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   infants &lt;int&gt;, suicides &lt;int&gt;, main_city &lt;ord&gt;, wealth &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   commerce &lt;int&gt;, clergy &lt;int&gt;, crime_parents &lt;int&gt;, infanticide &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   donation_clergy &lt;int&gt;, lottery &lt;int&gt;, desertion &lt;int&gt;, instruction &lt;int&gt;, …</span></span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Josiah Parry, Dexter H Locke.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
