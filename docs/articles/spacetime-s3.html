<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="sfdep">
<title>spacetime and spacetime cubes • sfdep</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Noto_Sans_Display-0.4.8/font.css" rel="stylesheet">
<link href="../deps/Noto_Sans_Mono-0.4.8/font.css" rel="stylesheet">
<link href="../deps/Merriweather-0.4.8/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="spacetime and spacetime cubes">
<meta property="og:description" content="sfdep">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">sfdep</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vignettes">Vignettes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-vignettes">
    <a class="dropdown-item" href="../articles/basics-of-sfdep.html">Basics of sfdep</a>
    <a class="dropdown-item" href="../articles/spacetime-s3.html">spacetime and spacetime cubes</a>
    <a class="dropdown-item" href="../articles/colocation-analysis.html">Colocation Quotients</a>
    <a class="dropdown-item" href="../articles/conditional-permutation.html">Conditional permutation</a>
    <a class="dropdown-item" href="../articles/understanding-emerging-hotspots.html">Emerging Hot Spot Analysis</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-releases">Releases</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-releases">
    <a class="dropdown-item" href="../articles/Version-0-2-0.html">Version 0.2.0</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/josiahparry/sfdep/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>spacetime and spacetime cubes</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/josiahparry/sfdep/blob/HEAD/vignettes/articles/spacetime-s3.Rmd" class="external-link"><code>vignettes/articles/spacetime-s3.Rmd</code></a></small>
      <div class="d-none name"><code>spacetime-s3.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sfdep.josiahparry.com" class="external-link">sfdep</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<p>sfdep introduces a new s3 class to represent spatio-temporal data.
The <code>spacetime</code> class links a flat data set containing
spatio-temporal information with the related geometry. The spacetime
class is informed by the <a href="https://github.com/edzer/spacetime" class="external-link">spacetime</a> package by Edzer
Pebesma (2012), and the interface is inspired by the design of
<a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a>.</p>
<div class="section level2">
<h2 id="spatio-temporal-data">Spatio-temporal data<a class="anchor" aria-label="anchor" href="#spatio-temporal-data"></a>
</h2>
<p>Traditionally “spatio-temporal data often come in the form of single
tables” that can typically be categorized as “time-wide”, “space-wide”,
or “long formats.” In long formats, often referred to as “tidy”, a row
identifies a unique location and time observation represented by a
column dedicated to time and another to locations. This is the typical
presentation of panel data.</p>
<p>Space-wide data present each time period across each row and
locational information in each column. Whereas a time-wide
representation has location data down the rows and each time period is
represented as a new column.</p>
<p>These flat formats are not linked to the geographies that they
represent in any meaningful way. These flat files typically contain only
an identifier of the location, but the spatial representation.</p>
<p>The <code>spacetime</code> class is developed with particular focus
to lattice data. That is, to create a representation of spatio-temporal
data for a set of regions over a number of different time-periods
e.g. population densities in census tracts for each year.</p>
<p>To represent spatial data in a temporal context Pebesma, 2012
identifies a number of spatio-temporal layouts, two of which are of
particular interest. These are the spatio-temporal full grid and sparse
grids.</p>
<p>Given a number of spatial features <span class="math inline">\(n\)</span>, and time periods <span class="math inline">\(m\)</span>, a <em>spatio-temporal full grid</em>
contains <span class="math inline">\(n \times m\)</span> rows. Each
location has a recorded observation for each of the time periods in
<span class="math inline">\(m\)</span>. For example, if there are 10
locations and 20 time periods, there are 20 observations per location
meaning there are <span class="math inline">\(10 \times 20 =
200\)</span> observations. This is efficient only when are there are
complete time-series for each location.</p>
<p>When there are missing observations for some locations or time
periods and they are entirely omitted from the data set, that is a
<em>spatio-temporal sparse grid</em>. In this case <span class="math inline">\(N \lt m \times n\)</span></p>
</div>
<div class="section level2">
<h2 id="spacetime-s3-class-in-sfdep">spacetime s3 class in sfdep<a class="anchor" aria-label="anchor" href="#spacetime-s3-class-in-sfdep"></a>
</h2>
<p>Inspired by the design of the tidygraph package, the spacetime class
links a data frame and an sf object based on a shared location
identifier column. These are referred to as the <em>data context</em>
and the <em>geometry context</em>. The spacetime class allows you switch
between different contexts and work with them individually as you see
fit.</p>
<p>Typically, if one wants to represent location data over multiple time
periods containing information about the geography, an sf object is used
which duplicates the geometry at each location for each time period
which can be computationally expensive. By linking sf objects to a data
frame based on their location ID, we are able to avoid this problem</p>
<p>There are four important aspects to the spacetime class:</p>
<ul>
<li>the data: a <code>data.frame</code> object</li>
<li>the geometry: an <code>sf</code> object</li>
<li>the location identifiers</li>
<li>the time column</li>
</ul>
<div class="section level3">
<h3 id="creating-a-spacetime-object">Creating a spacetime object<a class="anchor" aria-label="anchor" href="#creating-a-spacetime-object"></a>
</h3>
<p>There are two ways to create spacetime objects: 1) with
<code><a href="../reference/as_spacetime.html">as_spacetime()</a></code> and 2) <code><a href="../reference/spacetime.html">spacetime()</a></code> or
<code><a href="../reference/spacetime.html">new_spacetime()</a></code>. The former takes an sf object that
contains the location IDs, times, and geometry and converts it into a
spacetime object. Whereas the constructor functions require a data frame
and a separate sf object containing the geometry.</p>
<p>Let’s create a sample data set using the <code>guerry</code></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># replicate the guerry dataset 10 times</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_dfr</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">~</span><span class="va">guerry</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">code_dept</span>, <span class="va">crime_pers</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>         <span class="co"># create an indicator for time period</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>time_period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">85</span><span class="op">)</span><span class="op">)</span>, </span>
<span>         <span class="co"># add some noise </span></span>
<span>         crime_pers <span class="op">=</span> <span class="va">crime_pers</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">850</span>, max <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; Simple feature collection with 850 features and 3 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 47680 ymin: 1703258 xmax: 1031401 ymax: 2677441</span></span>
<span><span class="co">#&gt; CRS:           NA</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 850 × 4</span></span></span>
<span><span class="co">#&gt;    code_dept crime_pers                                     geometry time_period</span></span>
<span><span class="co">#&gt;  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                               <span style="color: #949494; font-style: italic;">&lt;MULTIPOLYGON&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 01            <span style="text-decoration: underline;">23</span>049. (((801150 2092615, 800669 2093190, 800688 2…           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 02            <span style="text-decoration: underline;">42</span>712. (((729326 2521619, 729320 2521230, 729280 2…           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 03            <span style="text-decoration: underline;">20</span>588. (((710830 2137350, 711746 2136617, 712430 2…           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 04             <span style="text-decoration: underline;">5</span>020. (((882701 1920024, 882408 1920733, 881778 1…           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 05            <span style="text-decoration: underline;">17</span>800. (((886504 1922890, 885733 1922978, 885479 1…           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 07            <span style="text-decoration: underline;">10</span>241. (((747008 1925789, 746630 1925762, 745723 1…           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 08            <span style="text-decoration: underline;">60</span>974. (((818893 2514767, 818614 2514515, 817900 2…           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 09             <span style="text-decoration: underline;">8</span>242. (((509103 1747787, 508820 1747513, 508154 1…           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 10             <span style="text-decoration: underline;">8</span>596. (((775400 2345600, 775068 2345397, 773587 2…           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 11            <span style="text-decoration: underline;">17</span>265. (((626230 1810121, 626269 1810496, 627494 1…           1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 840 more rows</span></span></span></code></pre></div>
<p>This representation, where there are duplicate geometries for each
location, should be cast into a spacetime object using
<code><a href="../reference/as_spacetime.html">as_spacetime()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_spacetime.html">as_spacetime</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"code_dept"</span>, <span class="st">"time_period"</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, we have the other scenario, where we have the geometry
and the data as two separate objects. In this case we can use the
<code><a href="../reference/spacetime.html">spacetime()</a></code> constructor. It’s required arguments are
<code>.data</code>, .<code>geometry</code>, <code>.loc_col</code>,
<code>.time_col</code>. <code>.data</code> must be a data frame and
<code>.geometry</code> must be a tibble.</p>
<p>Here we create a data frame <code>df</code> which contains columns
for the location identifier, the time period, and any other variables of
interest in this case <code>crime_pers</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">geo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">guerry</span>, <span class="va">code_dept</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   code_dept crime_pers time_period</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 01            <span style="text-decoration: underline;">23</span>049.           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 02            <span style="text-decoration: underline;">42</span>712.           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 03            <span style="text-decoration: underline;">20</span>588.           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 04             <span style="text-decoration: underline;">5</span>020.           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 05            <span style="text-decoration: underline;">17</span>800.           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 07            <span style="text-decoration: underline;">10</span>241.           1</span></span></code></pre></div>
<p>Note that the location identifier column is the same between the two
objects—this is a requirement.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spacetime.html">spacetime</a></span><span class="op">(</span></span>
<span>  .data <span class="op">=</span> <span class="va">df</span>, </span>
<span>  .geometry <span class="op">=</span> <span class="va">geo</span>, </span>
<span>  .loc_col <span class="op">=</span> <span class="st">"code_dept"</span>, </span>
<span>  .time_col <span class="op">=</span> <span class="st">"time_period"</span></span>
<span>  <span class="op">)</span> </span>
<span></span>
<span><span class="va">spt</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold; font-style: italic;">spacetime ────</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Context:</span><span style="color: #555555; font-style: italic;">`data`</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555; font-style: italic;">85</span><span style="color: #555555;"> locations `code_dept`</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555; font-style: italic;">10</span><span style="color: #555555;"> time periods `time_period`</span></span></span>
<span><span class="co">#&gt; <span style="color: #B2B2B2;">── </span><span style="color: #555555; font-style: italic;">data context</span><span style="color: #B2B2B2;"> ────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 850 × 3</span></span></span>
<span><span class="co">#&gt;    code_dept crime_pers time_period</span></span>
<span><span class="co">#&gt;  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 01            <span style="text-decoration: underline;">23</span>049.           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 02            <span style="text-decoration: underline;">42</span>712.           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 03            <span style="text-decoration: underline;">20</span>588.           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 04             <span style="text-decoration: underline;">5</span>020.           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 05            <span style="text-decoration: underline;">17</span>800.           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 07            <span style="text-decoration: underline;">10</span>241.           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 08            <span style="text-decoration: underline;">60</span>974.           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 09             <span style="text-decoration: underline;">8</span>242.           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 10             <span style="text-decoration: underline;">8</span>596.           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 11            <span style="text-decoration: underline;">17</span>265.           1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 840 more rows</span></span></span></code></pre></div>
<blockquote>
<p>As an aside, I’d note that <code><a href="../reference/as_spacetime.html">as_spacetime()</a></code> uses the sf
distinct method which can be a bit computationally intense depending on
your geometries. As such I’d recommend using <code><a href="../reference/spacetime.html">spacetime()</a></code>
constructor always.</p>
</blockquote>
<p>With the spacetime objects, we can also cast them back into sf
objects using <code>as_sf(x)</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="spacetime-contexts">Spacetime Contexts<a class="anchor" aria-label="anchor" href="#spacetime-contexts"></a>
</h2>
<p>Spacetime objects have two contexts: the data and geometry
contexts.</p>
<p>The <strong>data context</strong> consists of a data frame object. It
can be manipulated just like any other data frame. You switch between
contexts using <code><a href="../reference/activate.html">activate()</a></code>. To switch to the data context
activate “data.”</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/activate.html">activate</a></span><span class="op">(</span><span class="va">spt</span>, <span class="st">"data"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold; font-style: italic;">spacetime ────</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Context:</span><span style="color: #555555; font-style: italic;">`data`</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555; font-style: italic;">85</span><span style="color: #555555;"> locations `code_dept`</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555; font-style: italic;">10</span><span style="color: #555555;"> time periods `time_period`</span></span></span>
<span><span class="co">#&gt; <span style="color: #B2B2B2;">── </span><span style="color: #555555; font-style: italic;">data context</span><span style="color: #B2B2B2;"> ────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 850 × 3</span></span></span>
<span><span class="co">#&gt;    code_dept crime_pers time_period</span></span>
<span><span class="co">#&gt;  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 01            <span style="text-decoration: underline;">23</span>049.           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 02            <span style="text-decoration: underline;">42</span>712.           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 03            <span style="text-decoration: underline;">20</span>588.           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 04             <span style="text-decoration: underline;">5</span>020.           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 05            <span style="text-decoration: underline;">17</span>800.           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 07            <span style="text-decoration: underline;">10</span>241.           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 08            <span style="text-decoration: underline;">60</span>974.           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 09             <span style="text-decoration: underline;">8</span>242.           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 10             <span style="text-decoration: underline;">8</span>596.           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 11            <span style="text-decoration: underline;">17</span>265.           1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 840 more rows</span></span></span></code></pre></div>
<p>The <strong>geometry context</strong> is an sf object that too can be
used like any other sf object and is activated with
<code>activate(x, "geometry")</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spt</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/activate.html">activate</a></span><span class="op">(</span><span class="st">"geometry"</span><span class="op">)</span> </span>
<span><span class="co">#&gt; <span style="font-weight: bold; font-style: italic;">spacetime ────</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Context:</span><span style="color: #555555; font-style: italic;">`geometry`</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555; font-style: italic;">85</span><span style="color: #555555;"> locations `code_dept`</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555; font-style: italic;">10</span><span style="color: #555555;"> time periods `time_period`</span></span></span>
<span><span class="co">#&gt; <span style="color: #B2B2B2;">── </span><span style="color: #555555; font-style: italic;">geometry context</span><span style="color: #B2B2B2;"> ────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; Simple feature collection with 85 features and 1 field</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 47680 ymin: 1703258 xmax: 1031401 ymax: 2677441</span></span>
<span><span class="co">#&gt; CRS:           NA</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 85 × 2</span></span></span>
<span><span class="co">#&gt;    code_dept                                                            geometry</span></span>
<span><span class="co">#&gt;  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>                                                          <span style="color: #949494; font-style: italic;">&lt;MULTIPOLYGON&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 01        (((801150 2092615, 800669 2093190, 800688 2095430, 800780 2095795,…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 02        (((729326 2521619, 729320 2521230, 729280 2518544, 728751 2517520,…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 03        (((710830 2137350, 711746 2136617, 712430 2135212, 712070 2134132,…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 04        (((882701 1920024, 882408 1920733, 881778 1921200, 881526 1922332,…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 05        (((886504 1922890, 885733 1922978, 885479 1923276, 883061 1925266,…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 07        (((747008 1925789, 746630 1925762, 745723 1925138, 744216 1925236,…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 08        (((818893 2514767, 818614 2514515, 817900 2514467, 817327 2514945,…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 09        (((509103 1747787, 508820 1747513, 508154 1747093, 505861 1746627,…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 10        (((775400 2345600, 775068 2345397, 773587 2345177, 772940 2344780,…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 11        (((626230 1810121, 626269 1810496, 627494 1811321, 627681 1812424,…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 75 more rows</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="spatio-temporal-grids-and-spacetime">Spatio-temporal grids and spacetime<a class="anchor" aria-label="anchor" href="#spatio-temporal-grids-and-spacetime"></a>
</h2>
<p>Unlike <a href="https://github.com/edzer/spacetime" class="external-link">spacetime</a>, sfdep does not make explicit
distinctions between spatio-temporal full and sparse grids. Rather, the
approach is more laissez faire. The design of the spacetime interface is
very flexible and is designed to let the user clean their data with
whatever tools are familiar and to their own specification.</p>
<p>The distinction between sparse and full grids is important when it
comes to analyzing data. For example emerging hot spot analysis requires
a spatio-temporal full-grid. sfdep utilizes the phrase <em>“spacetime
cube”</em> as popularized by ESRI to refer to a spatio-temporal full
grid.</p>
<div class="section level3">
<h3 id="spacetime-cubes">Spacetime Cubes<a class="anchor" aria-label="anchor" href="#spacetime-cubes"></a>
</h3>
<p>A spacetime object is a spacetime cube if every location has a value
for every time index. Another way of saying this is that each location
contains a regular time-series.</p>
<p>In ESRI terminology, the basic unit of a spacetime cube is a
<em>bin</em>. A bin is the unique combination of a location and time
index. For each time index, the collection of every location is called a
<em>time slice</em>. In every location, the collection of every bin at
each time index is referred to as a a <em>bin time-series</em>.</p>
<p><img src="https://pro.arcgis.com/en/pro-app/2.8/tool-reference/space-time-pattern-mining/GUID-0FEECE1A-6B54-44B4-AE49-05E7EA849A8B-web.png"><!-- --></p>
<p>We can test if an object is a spacetime cube with
<code><a href="../reference/is_spacetime_cube.html">is_spacetime_cube()</a></code></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/is_spacetime_cube.html">is_spacetime_cube</a></span><span class="op">(</span><span class="va">spt</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Here we take a sample of 800 of the 850 rows of <code>spt</code>
which makes this a sparse grid.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sparse_spt</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_sample</a></span><span class="op">(</span><span class="va">spt</span>, n <span class="op">=</span> <span class="fl">800</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/is_spacetime_cube.html">is_spacetime_cube</a></span><span class="op">(</span><span class="va">sparse_spt</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Number of rows does not equal `n time-periods x n locations`</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>If an object is a spare spatio-temporal grid we can make it a full
one using <code><a href="../reference/complete_spacetime_cube.html">complete_spacetime_cube()</a></code>. This works similarly
to [<code><a href="https://tidyr.tidyverse.org/reference/complete.html" class="external-link">tidyr::complete()</a></code>].
<code><a href="../reference/complete_spacetime_cube.html">complete_spacetime_cube()</a></code> ensures that there is a row for
each combination of location and time. New rows will contain missing
values</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spt_complete</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/complete_spacetime_cube.html">complete_spacetime_cube</a></span><span class="op">(</span><span class="va">sparse_spt</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Vars(s) `crime_pers` is missing 50 value(s).</span></span>
<span></span>
<span><span class="fu"><a href="../reference/is_spacetime_cube.html">is_spacetime_cube</a></span><span class="op">(</span><span class="va">spt_complete</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>One of the conditions of being a spactime cube is that the
<em>time-series must be regular</em> (only one observation for each time
index). Here we can create a sample of our data with replacement to
create an irregular time-series at multiple locations.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">sparse_spt</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_sample</a></span><span class="op">(</span><span class="va">spt</span>, n <span class="op">=</span> <span class="fl">800</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/complete_spacetime_cube.html">complete_spacetime_cube</a></span><span class="op">(</span><span class="va">sparse_spt</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `complete_spacetime_cube()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Location and time combinations are not unique.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> There should only be one observation per time and location combination.</span></span></code></pre></div>
<p>This error is informative. We do not have unique bins in our
spacetime data. We can check this.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">sparse_spt</span>, <span class="va">time_period</span>, <span class="va">code_dept</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold; font-style: italic;">spacetime ────</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Context:</span><span style="color: #555555; font-style: italic;">`data`</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555; font-style: italic;">85</span><span style="color: #555555;"> locations `code_dept`</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555; font-style: italic;">10</span><span style="color: #555555;"> time periods `time_period`</span></span></span>
<span><span class="co">#&gt; <span style="color: #B2B2B2;">── </span><span style="color: #555555; font-style: italic;">data context</span><span style="color: #B2B2B2;"> ────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 517 × 3</span></span></span>
<span><span class="co">#&gt;    time_period code_dept     n</span></span>
<span><span class="co">#&gt;          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>           1 01            1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>           1 03            1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>           1 05            1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>           1 07            1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>           1 09            1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>           1 12            1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>           1 16            1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>           1 17            2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>           1 18            1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>           1 21            2</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 507 more rows</span></span></span></code></pre></div>
<p>Spacetime cubes are used for emerging hot spot analysis as below.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emerging_hotspot_analysis.html">emerging_hotspot_analysis</a></span><span class="op">(</span><span class="va">spt</span>, <span class="st">"crime_pers"</span>, threshold <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 85 × 4</span></span></span>
<span><span class="co">#&gt;    location     tau p_value classification     </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 01       -<span style="color: #BB0000;">0.066</span><span style="color: #BB0000; text-decoration: underline;">7</span>   0.858 sporadic hotspot   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 02        0.289    0.283 sporadic hotspot   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 03       -<span style="color: #BB0000;">0.111</span>    0.721 sporadic hotspot   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 04       -<span style="color: #BB0000;">0.244</span>    0.371 sporadic coldspot  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 05       -<span style="color: #BB0000;">0.244</span>    0.371 sporadic coldspot  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 07       -<span style="color: #BB0000;">0.422</span>    0.107 sporadic coldspot  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 08        0.200    0.474 consecutive hotspot</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 09        0.422    0.107 sporadic coldspot  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 10        0.378    0.152 sporadic hotspot   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 11        0.156    0.592 sporadic coldspot  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 75 more rows</span></span></span></code></pre></div>
<!--

-   The spacetime cube as made popular by ESRI is a spatio-temporal full grid (Pebesma, 2012)

    -   when setting columns from geometry context to data context follows this advice "for each moment in time, the same set of spatial entities is sampled." (Pebesma, 2012)

-   "Unsampled combinations of (space, time) are stored in this class, but are assigned a missing value NA." (Pebesma, 2012)

    -   If data is represented in a "spatio-temporal sparse grid" it can be made into a full grid using `complete_spacetime_cube()`

‚
-->
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Josiah Parry, Dexter H Locke.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
